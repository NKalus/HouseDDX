services:
  - type: web
    name: house-ddx
    runtime: python
    plan: free
    buildCommand: >
      python -V &&
      python -m pip install --upgrade pip &&
      pip -V &&
      pip install --no-cache-dir -r requirements.txt
    startCommand: "gunicorn -w 2 -k gthread -t 120 -b 0.0.0.0:$PORT app:app"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
      - key: TF_CPP_MIN_LOG_LEVEL
        value: "2"             # quieter TF logs
      - key: CUDA_VISIBLE_DEVICES
        value: "-1"            # CPU only
    healthCheckPath: "/__health"
    autoDeploy: true
